{"version":3,"sources":["webpack:///./src/views/settings/settings.vue?ea48","webpack:///./node_modules/core-js/modules/es.function.name.js","webpack:///./src/views/settings/settings.vue?6980","webpack:///src/views/settings/settings.vue","webpack:///./src/views/settings/settings.vue?9327","webpack:///./src/views/settings/settings.vue"],"names":["DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","this","match","error","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","slot","_v","_s","userInfo","id","mobile","model","value","callback","$$v","$set","expression","on","hUpdate","hUpload","hBeforeUpload","photo","staticRenderFns","name","data","headers","Authorization","imageUrl","email","intro","created","loadUserInfo","methods","doSave","isJPG","$message","isLt2M","component"],"mappings":"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","file":"js/chunk-5dff19c3.523cb26d.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings.vue?vue&type=style&index=0&id=539ad62a&lang=less&scoped=true&\"","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.github.io/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-card',[_c('div',{staticClass:\"clearfix\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('my-breadcrumb',[_vm._v(\"个人设置\")])],1),_c('el-row',[_c('el-col',{attrs:{\"span\":16}},[_c('el-form',{attrs:{\"label-width\":\"120px\"}},[_c('el-form-item',{attrs:{\"label\":\"编号：\"}},[_vm._v(_vm._s(_vm.userInfo.id))]),_c('el-form-item',{attrs:{\"label\":\"手机：\"}},[_vm._v(_vm._s(_vm.userInfo.mobile))]),_c('el-form-item',{attrs:{\"label\":\"媒体名称：\"}},[_c('el-input',{model:{value:(_vm.userInfo.name),callback:function ($$v) {_vm.$set(_vm.userInfo, \"name\", $$v)},expression:\"userInfo.name\"}})],1),_c('el-form-item',{attrs:{\"label\":\"媒体简介：\"}},[_c('el-input',{attrs:{\"type\":\"textarea\",\"rows\":3},model:{value:(_vm.userInfo.intro),callback:function ($$v) {_vm.$set(_vm.userInfo, \"intro\", $$v)},expression:\"userInfo.intro\"}})],1),_c('el-form-item',{attrs:{\"label\":\"联系邮箱：\"}},[_c('el-input',{model:{value:(_vm.userInfo.email),callback:function ($$v) {_vm.$set(_vm.userInfo, \"email\", $$v)},expression:\"userInfo.email\"}})],1),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.hUpdate}},[_vm._v(\"保存设置\")])],1)],1)],1),_c('el-col',{attrs:{\"span\":8}},[_c('el-upload',{staticClass:\"avatar-uploader\",attrs:{\"action\":\"\",\"http-request\":_vm.hUpload,\"show-file-list\":false,\"before-upload\":_vm.hBeforeUpload}},[(_vm.userInfo.photo)?_c('img',{staticClass:\"avatar\",attrs:{\"src\":_vm.userInfo.photo}}):_c('i',{staticClass:\"el-icon-plus avatar-uploader-icon\"})])],1)],1),_c('div')],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <el-card>\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <my-breadcrumb>个人设置</my-breadcrumb>\r\n      </div>\r\n<el-row>\r\n        <el-col :span=\"16\">\r\n          <!-- 表单 -->\r\n          <el-form label-width=\"120px\">\r\n            <el-form-item label=\"编号：\">{{userInfo.id}}</el-form-item>\r\n            <el-form-item label=\"手机：\">{{userInfo.mobile}}</el-form-item>\r\n            <el-form-item label=\"媒体名称：\">\r\n              <el-input v-model=\"userInfo.name\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"媒体简介：\">\r\n              <el-input v-model=\"userInfo.intro\" type=\"textarea\" :rows=\"3\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"联系邮箱：\">\r\n              <el-input v-model=\"userInfo.email\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button @click=\"hUpdate\" type=\"primary\">保存设置</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <!-- 上传组件-->\r\n         <el-upload\r\n                  class=\"avatar-uploader\"\r\n                  action=\"\"\r\n                   :http-request=\"hUpload\"\r\n                  :show-file-list=\"false\"\r\n                  :before-upload=\"hBeforeUpload\">\r\n              <img v-if=\"userInfo.photo\" :src=\"userInfo.photo\" class=\"avatar\">\r\n                  <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n</el-upload>\r\n        </el-col>\r\n      </el-row>\r\n      <div>\r\n\r\n        <!-- 右边是头像区域 -->\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n<script>\r\nexport default {\r\n  name: 'setting',\r\n  data () {\r\n    return {\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('tokenStr')}`\r\n      },\r\n      imageUrl: '',\r\n      userInfo: {\r\n        id: '',\r\n        email: '',\r\n        intro: '',\r\n        mobile: '',\r\n        name: '',\r\n        photo: ''\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    this.loadUserInfo()\r\n  },\r\n  methods: {\r\n    // 自定义 实现 图像上传\r\n    // 这个回调在上传文件时，自动被调用。它的参数是一个对象\r\n    // 这个对象中有一个file属性表示当前要上传的文件\r\n    async hUpload (obj) {\r\n      try {\r\n        const { file } = obj\r\n        // console.log('自定义 实现 图像上传', file)\r\n        // 上传文件一定要用formData\r\n        const fd = new FormData()\r\n        // 添加参数\r\n        fd.append('photo', file)\r\n\r\n        // 就是要实现文件上传\r\n        const res = await this.$http({\r\n          url: '/mp/v1_0/user/photo',\r\n          method: 'PATCH',\r\n          // 如果用formData去传参数，则请求头中content-type是：multipart-form-data.\r\n          // 这个格式就是接口文档中要求的请求头的类型。\r\n          data: fd\r\n          // 如果用下面的普通的方式去传递参数，则请求头中的content-type是：application/json\r\n          // data: {\r\n          //   photo: file\r\n          // }\r\n        })\r\n        this.$message.success('更新头像成功')\r\n        console.log(res)\r\n        // 1. 更新视图\r\n        // 1.为userForm.photo重新赋值\r\n        this.userInfo.photo = res.data.data.photo\r\n        // 2.监听事件 更换头像\r\n        this.$eventBus.$emit('update-user-info', { photo: res.data.data.photo })\r\n      } catch (err) {\r\n        console.log(err)\r\n        // 2. 发布事件- layout.vue中的图像也要修改\r\n        // this.$message.error('更新头像失败')\r\n        // this.$eventBus.$emit('update-user-info', { photo: res.data.data.photo })\r\n      }\r\n    },\r\n    async loadUserInfo () {\r\n      const res = await this.$http({\r\n        url: '/mp/v1_0/user/profile',\r\n        method: 'GET'\r\n      })\r\n      console.log('获取个人信息', res)\r\n      this.userInfo.id = res.data.data.id\r\n      this.userInfo.email = res.data.data.email\r\n      this.userInfo.intro = res.data.data.intro\r\n      this.userInfo.mobile = res.data.data.mobile\r\n      this.userInfo.name = res.data.data.name\r\n      this.userInfo.photo = res.data.data.photo\r\n    },\r\n    hUpdate () {\r\n      // 保存数据\r\n      // TODO:表单检验\r\n      this.doSave()\r\n    },\r\n\r\n    async doSave () {\r\n      const { name, intro, email } = this.userInfo\r\n      try {\r\n        const res = await this.$http({\r\n          url: '/mp/v1_0/user/profile',\r\n          method: 'PATCH',\r\n          data: {\r\n            name,\r\n            intro,\r\n            email\r\n          }\r\n        })\r\n        console.log(res)\r\n        this.$message.success('修改成功')\r\n\r\n        // 发布事件\r\n        this.$eventBus.$emit('update-user-info', { name })\r\n      } catch (err) {\r\n        console.log(err)\r\n        this.$message.error('修改失败')\r\n      }\r\n    },\r\n    hBeforeUpload (file) {\r\n      const isJPG = file.type === 'image/jpeg'\r\n      // file.size 单位是字节\r\n      const isLt2M = file.size / 1024 / 1024 < 2\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG 格式!')\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!')\r\n      }\r\n      return isJPG && isLt2M\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.avatar-uploader {\r\n    text-align: center;\r\n  }\r\n  .avatar{\r\n    width: 300px;\r\n  }\r\n  .avatar-uploader-icon {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 178px;\r\n    height: 178px;\r\n    line-height: 178px;\r\n    text-align: center;\r\n  }\r\n  .avatar-uploader /deep/ .el-upload {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n  }\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./settings.vue?vue&type=template&id=539ad62a&scoped=true&\"\nimport script from \"./settings.vue?vue&type=script&lang=js&\"\nexport * from \"./settings.vue?vue&type=script&lang=js&\"\nimport style0 from \"./settings.vue?vue&type=style&index=0&id=539ad62a&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"539ad62a\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}