{"version":3,"sources":["webpack:///./src/views/image/image.vue?3360","webpack:///src/views/image/image.vue","webpack:///./src/views/image/image.vue?e34e","webpack:///./src/views/image/image.vue","webpack:///./src/views/image/image.vue?b1e1"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","slot","_v","staticStyle","on","YToggle","model","value","callback","$$v","isCollected","expression","$event","dialogVisible","_l","image","key","id","url","directives","name","rawName","style","color","is_collected","hSwitchCollect","hDelete","total_count","hPageChange","headers","hBeforeUpload","hUploadSuccess","imageUrl","hpreviewImageload","staticRenderFns","data","curPage","isCollect","images","Authorization","created","loadImages","methods","console","log","page","res","isJPG","$message","error","isLt2M","Date","now","setTimeout","$confirm","then","component"],"mappings":"yHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,mBAAmB,CAACF,EAAG,UAAU,CAACE,YAAY,YAAY,CAACF,EAAG,MAAM,CAACG,MAAM,CAAC,KAAO,UAAUC,KAAK,UAAU,CAACJ,EAAG,gBAAgB,CAACJ,EAAIS,GAAG,WAAW,GAAGL,EAAG,MAAM,CAACM,YAAY,CAAC,iBAAiB,SAAS,CAACN,EAAG,iBAAiB,CAACG,MAAM,CAAC,KAAO,UAAUI,GAAG,CAAC,OAASX,EAAIY,SAASC,MAAM,CAACC,MAAOd,EAAe,YAAEe,SAAS,SAAUC,GAAMhB,EAAIiB,YAAYD,GAAKE,WAAW,gBAAgB,CAACd,EAAG,kBAAkB,CAACG,MAAM,CAAC,OAAQ,IAAQ,CAACP,EAAIS,GAAG,QAAQL,EAAG,kBAAkB,CAACG,MAAM,CAAC,OAAQ,IAAO,CAACP,EAAIS,GAAG,SAAS,GAAGL,EAAG,YAAY,CAACM,YAAY,CAAC,MAAQ,SAASH,MAAM,CAAC,KAAO,UAAU,KAAO,QAAQI,GAAG,CAAC,MAAQ,SAASQ,GAAQnB,EAAIoB,eAAc,KAAQ,CAACpB,EAAIS,GAAG,cAAc,GAAGL,EAAG,SAAS,CAACG,MAAM,CAAC,OAAS,KAAKP,EAAIqB,GAAIrB,EAAU,QAAE,SAASsB,GAAO,OAAOlB,EAAG,SAAS,CAACmB,IAAID,EAAME,GAAGlB,YAAY,WAAWC,MAAM,CAAC,KAAO,IAAI,CAACH,EAAG,WAAW,CAACM,YAAY,CAAC,OAAS,QAAQ,MAAQ,SAASH,MAAM,CAAC,IAAMe,EAAMG,IAAI,IAAM,WAAWrB,EAAG,MAAM,CAACsB,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASd,OAAQd,EAAIiB,YAAaC,WAAW,iBAAiBZ,YAAY,UAAU,CAACF,EAAG,OAAO,CAACE,YAAY,mBAAmBuB,MAAM,CAAEC,MAAMR,EAAMS,aAAe,MAAO,QAASpB,GAAG,CAAC,MAAQ,SAASQ,GAAQ,OAAOnB,EAAIgC,eAAeV,OAAWlB,EAAG,OAAO,CAACE,YAAY,iBAAiBK,GAAG,CAAC,MAAQ,SAASQ,GAAQ,OAAOnB,EAAIiC,QAAQX,EAAME,WAAW,MAAK,GAAGpB,EAAG,gBAAgB,CAACM,YAAY,CAAC,aAAa,QAAQH,MAAM,CAAC,WAAa,GAAG,OAAS,oBAAoB,MAAQP,EAAIkC,aAAavB,GAAG,CAAC,iBAAiBX,EAAImC,gBAAgB,GAAG/B,EAAG,YAAY,CAACG,MAAM,CAAC,iBAAiB,GAAG,MAAQ,OAAO,QAAUP,EAAIoB,eAAeT,GAAG,CAAC,iBAAiB,SAASQ,GAAQnB,EAAIoB,cAAcD,KAAU,CAACf,EAAG,YAAY,CAACE,YAAY,kBAAkBC,MAAM,CAAC,OAAS,sDAAsD,QAAUP,EAAIoC,QAAQ,KAAO,QAAQ,kBAAiB,EAAM,gBAAgBpC,EAAIqC,cAAc,aAAarC,EAAIsC,iBAAiB,CAAEtC,EAAY,SAAEI,EAAG,WAAW,CAACE,YAAY,SAASC,MAAM,CAAC,IAAMP,EAAIuC,UAAU5B,GAAG,CAAC,KAAOX,EAAIwC,qBAAqBpC,EAAG,IAAI,CAACE,YAAY,uCAAuC,IAAI,IAAI,IACtoEmC,EAAkB,G,wBC+FtB,GACEd,KAAM,YACNe,KAFF,WAGI,MAAO,CACLtB,eAAe,EACfH,aAAa,EACb0B,QAAS,EACTT,YAAa,EACbU,WAAW,EACXC,OAAQ,GACRN,SAAU,GACVH,QAAS,CACPU,cAAe,UAAvB,4CAIEC,QAhBF,WAiBI9C,KAAK+C,cAEPC,QAAS,CACP,WADJ,WACA,8KAEA,SACA,2BACA,aACA,QACA,YACA,sBACA,kBARA,OAEA,EAFA,OAYA,sCACA,6BAbA,8CAgBIrC,QAjBJ,WAkBMsC,QAAQC,IAAIlD,KAAKgB,aAEjBhB,KAAK0C,QAAU,EAEf1C,KAAK+C,cAGPb,YAzBJ,SAyBA,GAEMlC,KAAK0C,QAAUS,EAEfnD,KAAK+C,cAGPV,eAhCJ,SAgCA,KAEMrC,KAAKsC,SAAWc,EAAIX,KAAKjB,IAGzBxB,KAAK+C,cAEPX,cAvCJ,SAuCA,GACM,IAAN,wBAEA,qBAOM,OANKiB,GACHrD,KAAKsD,SAASC,MAAM,qBAEjBC,GACHxD,KAAKsD,SAASC,MAAM,qBAEfF,GAASG,GAElBjB,kBAnDJ,WAmDA,WAEMU,QAAQC,IAAI,SAAUO,KAAKC,OAC3BC,YAAW,WACT,EAAR,iBACQ,EAAR,cACA,MAGI,eA5DJ,SA4DA,0KAEA,OACA,eAHA,kBAMA,SACA,8BACA,aACA,MAEA,2BAXA,OAMA,EANA,OAcA,eACA,2BAIA,+BAnBA,qDAqBA,kBACA,yBAtBA,6DAyBI,SArFJ,SAqFA,0LAEA,SACA,8BACA,kBAJA,OAEA,EAFA,OAMA,2BAEA,eAEA,eAVA,mDAYA,kBACA,yBAbA,4DAiBI3B,QAtGJ,SAsGA,cACMhC,KAAK4D,SAAS,WAAWC,MAAK,WAC5B,EAAR,eACA,yBC5N8V,I,wBCQ1VC,EAAY,eACd,EACAhE,EACA0C,GACA,EACA,KACA,WACA,MAIa,aAAAsB,E,6CCnBf,W","file":"js/chunk-641bea04.c29c47b7.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"image-container\"},[_c('el-card',{staticClass:\"box-card\"},[_c('div',{attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('my-breadcrumb',[_vm._v(\"素材管理\")])],1),_c('div',{staticStyle:{\"padding-bottom\":\"20px\"}},[_c('el-radio-group',{attrs:{\"size\":\"medium\"},on:{\"change\":_vm.YToggle},model:{value:(_vm.isCollected),callback:function ($$v) {_vm.isCollected=$$v},expression:\"isCollected\"}},[_c('el-radio-button',{attrs:{\"label\":false}},[_vm._v(\"全部\")]),_c('el-radio-button',{attrs:{\"label\":true}},[_vm._v(\"收藏\")])],1),_c('el-button',{staticStyle:{\"float\":\"right\"},attrs:{\"type\":\"success\",\"size\":\"mini\"},on:{\"click\":function($event){_vm.dialogVisible=true}}},[_vm._v(\"上传图片素材 \")])],1),_c('el-row',{attrs:{\"gutter\":10}},_vm._l((_vm.images),function(image){return _c('el-col',{key:image.id,staticClass:\"img_item\",attrs:{\"span\":4}},[_c('el-image',{staticStyle:{\"height\":\"180px\",\"width\":\"180px\"},attrs:{\"src\":image.url,\"fit\":\"cover\"}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.isCollected),expression:\"!isCollected\"}],staticClass:\"option\"},[_c('span',{staticClass:\"el-icon-star-off\",style:({color:image.is_collected ? 'red': '#fff'}),on:{\"click\":function($event){return _vm.hSwitchCollect(image)}}}),_c('span',{staticClass:\"el-icon-delete\",on:{\"click\":function($event){return _vm.hDelete(image.id)}}})])],1)}),1),_c('el-pagination',{staticStyle:{\"margin-top\":\"10px\"},attrs:{\"background\":\"\",\"layout\":\"prev, pager, next\",\"total\":_vm.total_count},on:{\"current-change\":_vm.hPageChange}})],1),_c('el-dialog',{attrs:{\"append-to-body\":\"\",\"title\":\"上传素材\",\"visible\":_vm.dialogVisible},on:{\"update:visible\":function($event){_vm.dialogVisible=$event}}},[_c('el-upload',{staticClass:\"avatar-uploader\",attrs:{\"action\":\"http://ttapi.research.itcast.cn/mp/v1_0/user/images\",\"headers\":_vm.headers,\"name\":\"image\",\"show-file-list\":false,\"before-upload\":_vm.hBeforeUpload,\"on-success\":_vm.hUploadSuccess}},[(_vm.imageUrl)?_c('el-image',{staticClass:\"avatar\",attrs:{\"src\":_vm.imageUrl},on:{\"load\":_vm.hpreviewImageload}}):_c('i',{staticClass:\"el-icon-plus avatar-uploader-icon\"})],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"image-container\">\r\n    <el-card class=\"box-card\">\r\n      <div slot=\"header\">\r\n       <my-breadcrumb>素材管理</my-breadcrumb>\r\n      </div>\r\n<div style=\"padding-bottom:20px;\">\r\n        <!-- 对于数据项：collect: false\r\n                当选中全部时，它的值是false\r\n                当选中收藏时，它的值是true\r\n\r\n            对于el-radio组件，可以通过label来设置当前项被中时的值\r\n            :label=\"false\" 表示一个布尔值 false\r\n            label=\"false\"  表示一个普通的字符串 'false'\r\n        -->\r\n        <el-radio-group v-model=\"isCollected\" size=\"medium\" @change=\"YToggle\">\r\n          <el-radio-button :label=\"false\">全部</el-radio-button>\r\n          <el-radio-button :label=\"true\">收藏</el-radio-button>\r\n        </el-radio-group>\r\n        <el-button\r\n         @click=\"dialogVisible=true\"\r\n         type=\"success\" size=\"mini\" style=\"float:right\">上传图片素材          </el-button>\r\n      </div>\r\n      <!-- 素材列表 -->\r\n<el-row :gutter=\"10\">\r\n        <el-col\r\n        :span=\"4\"\r\n        v-for=\"image in images\"\r\n        :key=\"image.id\"\r\n        class=\"img_item\">\r\n          <el-image\r\n            style=\"height: 180px;width: 180px\"\r\n            :src=\"image.url\"\r\n            fit=\"cover\"\r\n          ></el-image>\r\n          <div class=\"option\" v-show=\"!isCollected\">\r\n            <!-- 是否收藏 -->\r\n<span\r\n  :style=\"{color:image.is_collected ? 'red': '#fff'}\"\r\n  class=\"el-icon-star-off\"\r\n@click=\"hSwitchCollect(image)\">\r\n</span>\r\n            <span class=\"el-icon-delete\" @click=\"hDelete(image.id)\"></span>\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n      <!-- /素材列表 -->\r\n      <!-- 分页\r\n        1.total: 一共有多少条数据 默认情况，它会以每页10条进行计算总页数\r\n        2. current-change事件。当点击页码时，它会触发并会传入当前的页码。\r\n      -->\r\n      <el-pagination\r\n        style=\"margin-top: 10px\"\r\n        background\r\n        layout=\"prev, pager, next\"\r\n        @current-change=\"hPageChange\"\r\n        :total=\"total_count\">\r\n      </el-pagination>\r\n    </el-card>\r\n\r\n    <!--\r\n      .sync可以用来做双向绑定\r\n      append-to-body: 让对话框显示在最上层\r\n    -->\r\n<el-dialog\r\n      append-to-body\r\n      title=\"上传素材\"\r\n      :visible.sync=\"dialogVisible\">\r\n<!--\r\n- action： 必选参数，上传的地址：http://ttapi.research.itcast.cn/mp/v1_0/user/images\r\n- headers: 设置上传的请求头部。要携带token\r\n- name：上传的文件字段名。要与接口中要求保持一致。\r\n- show-file-list： 是否显示已上传文件列表\r\n- on-success：文件上传成功时的钩子。`function(response, file, fileList)`\r\n- before-upload: 上传之前对文件进行检测。 -->\r\n      <el-upload\r\n        class=\"avatar-uploader\"\r\n        action=\"http://ttapi.research.itcast.cn/mp/v1_0/user/images\"\r\n        :headers=\"headers\"\r\n        name=\"image\"\r\n        :show-file-list=\"false\"\r\n        :before-upload=\"hBeforeUpload\"\r\n        :on-success=\"hUploadSuccess\"\r\n        >\r\n        <!-- img用来显示上传成功之后的图像 -->\r\n        <el-image v-if=\"imageUrl\" :src=\"imageUrl\" @load=\"hpreviewImageload\" class=\"avatar\" />\r\n        <!-- <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\"> -->\r\n        <!-- 显示引导用户上传的 那个 + 号 -->\r\n        <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n\r\n      </el-upload>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'Imagedata',\r\n  data () {\r\n    return {\r\n      dialogVisible: false, // 是否显示弹出对话框\r\n      isCollected: false, // 是否是 收藏的图片， true表示是收藏，false表示是全部\r\n      curPage: 1, // 当前查询第几页\r\n      total_count: 0, // 查询的总数量\r\n      isCollect: false, // 是否是收藏的图片\r\n      images: [], // 素材列表\r\n      imageUrl: '', // 图片的预览地址。当上传成传会从后端返回的结果取出\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('tokenStr')}`\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    this.loadImages()\r\n  },\r\n  methods: {\r\n    async loadImages () {\r\n      // 发请求，获取数据，保存到images中\r\n      const res = await this.$http({\r\n        url: '/mp/v1_0/user/images',\r\n        method: 'GET',\r\n        params: {\r\n          per_page: 10, // 固定每页只取回10条\r\n          collect: this.isCollected, // 是否是收藏的图片\r\n          page: this.curPage\r\n        }\r\n      })\r\n      // 更新总条数\r\n      this.total_count = res.data.data.total_count\r\n      this.images = res.data.data.results\r\n    },\r\n    // 切换筛选条件\r\n    YToggle () {\r\n      console.log(this.isCollected)\r\n      // 1. 更新页码 为1\r\n      this.curPage = 1\r\n      // 2. 发请求\r\n      this.loadImages()\r\n    },\r\n    // 用户点击了分页\r\n    hPageChange (page) {\r\n      // 1. 更新页码\r\n      this.curPage = page\r\n      // 2. 重发请求\r\n      this.loadImages()\r\n    },\r\n    // 上传成功\r\n    hUploadSuccess (res, file) {\r\n      // 1. 预览效果\r\n      this.imageUrl = res.data.url\r\n      // console.log('文件上传成功', res, file)\r\n      // 2. 重新请求一次\r\n      this.loadImages()\r\n    },\r\n    hBeforeUpload (file) {\r\n      const isJPG = file.type === 'image/jpeg'\r\n      // file.size 单位是字节\r\n      const isLt2M = file.size / 1024 / 1024 < 2\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG 格式!')\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!')\r\n      }\r\n      return isJPG && isLt2M\r\n    },\r\n    hpreviewImageload () {\r\n      // 表示图片预览成功\r\n      console.log('图片预览成功', Date.now())\r\n      setTimeout(() => {\r\n        this.dialogVisible = false\r\n        this.imageUrl = ''\r\n      }, 2000)\r\n    },\r\n    // 切换是否收藏的状态\r\n    async hSwitchCollect (image) {\r\n      // image是当前用户选中收藏与否 时， 所操作那张图\r\n      const imageId = image.id\r\n      console.log(image)\r\n      try {\r\n        // 调用接口，传递参数\r\n        const res = await this.$http({\r\n          url: '/mp/v1_0/user/images/' + imageId,\r\n          method: 'PUT',\r\n          data: {\r\n            // false-取消收藏，true-添加收藏\r\n            collect: !image.is_collected\r\n          }\r\n        })\r\n        console.log(res)\r\n        this.$message.success('操作成功')\r\n        // 更新页面\r\n        // 有两种方式：1. 整体重发请求；2. 只更新当前的数据项\r\n        // 修改数据，会引起视图的变化\r\n        image.is_collected = !image.is_collected\r\n      } catch (err) {\r\n        console.log(err)\r\n        this.$message.error('操作失败')\r\n      }\r\n    },\r\n    async doDelete (id) {\r\n      try {\r\n        const res = await this.$http({\r\n          url: '/mp/v1_0/user/images/' + id,\r\n          method: 'DELETE'\r\n        })\r\n        this.$message.success('操作成功')\r\n        // 更新页面\r\n        console.log(res)\r\n        // 发请求更新\r\n        this.loadImages()\r\n      } catch (err) {\r\n        console.log(err)\r\n        this.$message.error('操作失败')\r\n      }\r\n    },\r\n    // 用户删除图像\r\n    hDelete (id) {\r\n      this.$confirm('你真的删除吗?').then(() => {\r\n        this.doDelete(id)\r\n      }).catch(() => {\r\n        // 取消退出 . 这里不要删除了。如果删除了，promise的结构就不完整了，当用户点了取消之后\r\n        // 就会报错误\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .img_item {\r\n    position: relative;\r\n    box-sizing: border-box;\r\n  }\r\n  .option {\r\n    position: absolute;\r\n    left: 5px;\r\n    width:180px;\r\n    bottom: 5px;\r\n    height: 30px;\r\n    line-height: 30px;\r\n    background: rgba(0, 0, 0, 0.3);\r\n    text-align: center;\r\n    color: #fff;\r\n    span {\r\n      margin: 0 30px;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n.avatar-uploader {\r\n    text-align: center;\r\n}\r\n.avatar-uploader-icon {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 178px;\r\n    height: 178px;\r\n    line-height: 178px;\r\n    text-align: center;\r\n}\r\n.avatar-uploader /deep/ .el-upload {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\n.red {\r\n   color: red;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./image.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./image.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./image.vue?vue&type=template&id=241ecaaa&scoped=true&\"\nimport script from \"./image.vue?vue&type=script&lang=js&\"\nexport * from \"./image.vue?vue&type=script&lang=js&\"\nimport style0 from \"./image.vue?vue&type=style&index=0&id=241ecaaa&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"241ecaaa\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./image.vue?vue&type=style&index=0&id=241ecaaa&lang=less&scoped=true&\""],"sourceRoot":""}